<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Google Play warning(You are using a vulnerable version of libpng) | Luucio&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="今天收到Google Play的一个邮件,提示我很早上线的一个游戏的libpng版本太低，会有一定的敏感问题，后续升级若使用低版本的libpng库的app都会被打回。

Hello Google Play Developer,We detected that your app(s) listed at the end of this email are using an unsafe versio">
<meta property="og:type" content="article">
<meta property="og:title" content="Google Play warning(You are using a vulnerable version of libpng)">
<meta property="og:url" content="http://xiao.luucio.com/2016/06/17/Google-Play-warnings/index.html">
<meta property="og:site_name" content="Luucio's blog">
<meta property="og:description" content="今天收到Google Play的一个邮件,提示我很早上线的一个游戏的libpng版本太低，会有一定的敏感问题，后续升级若使用低版本的libpng库的app都会被打回。

Hello Google Play Developer,We detected that your app(s) listed at the end of this email are using an unsafe versio">
<meta property="og:updated_time" content="2016-06-17T03:12:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Google Play warning(You are using a vulnerable version of libpng)">
<meta name="twitter:description" content="今天收到Google Play的一个邮件,提示我很早上线的一个游戏的libpng版本太低，会有一定的敏感问题，后续升级若使用低版本的libpng库的app都会被打回。

Hello Google Play Developer,We detected that your app(s) listed at the end of this email are using an unsafe versio">
  
    <link rel="alternative" href="/atom.xml" title="Luucio&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ww3.sinaimg.cn/large/703e3188gw1eytr6acm9fj208c08ct96.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Luucio</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Constant dropping wears the stone</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
							<li><a href="/photo">相册</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="http://github.com" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/tomatofriedeggs" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="http://luucio.com/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/技术/" style="font-size: 20px;">技术</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://macshuo.com">MacTalk-池建强的随想录</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://ibruce.info">不如</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">代码猴子，游戏汪，未来的全栈攻城狮，犊力开发者</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Luucio</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://ww3.sinaimg.cn/large/703e3188gw1eytr6acm9fj208c08ct96.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Luucio</h1>
			</hgroup>
			
			<p class="header-subtitle">Constant dropping wears the stone</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
					<li><a href="/photo">相册</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/tomatofriedeggs" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="http://luucio.com/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Google-Play-warnings" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/17/Google-Play-warnings/" class="article-date">
  	<time datetime="2016-06-17T02:55:22.000Z" itemprop="datePublished">2016-06-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Google Play warning(You are using a vulnerable version of libpng)
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/技术/">技术</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天收到Google Play的一个邮件,提示我很早上线的一个游戏的libpng版本太低，会有一定的敏感问题，后续升级若使用低版本的libpng库的app都会被打回。</p>
<blockquote>
<p>Hello Google Play Developer,<br>We detected that your app(s) listed at the end of this email are using an unsafe version of the libpng library. Apps with vulnerabilities like this can expose users to risk of compromise and may be considered in violation of our Malicious Behavior policy.<br>What’s happening<br>Beginning September 17, 2016, Google Play will block publishing of any new apps or updates that use vulnerable versions of libpng. Your published APK version will not be affected, however any updates to the app will be blocked unless you address this vulnerability.<br>Action required: Migrate your app(s) to use libpng v1.0.66, v.1.2.56, v.1.4.19, v1.5.26 or higher as soon as possible and increment the version number of the upgraded APK.<br>Next steps<br>Download the latest version of libpng from the libpng website.<br>Sign in to your Developer Console and submit the updated version of your app.<br>Check back after five hours - we’ll show a warning message if the app hasn’t been updated correctly.<br>The vulnerability stems from an out of bounds memory access that could potentially lead to code execution. Versions 1.0.x before 1.0.66, 1.1.x and 1.2.x before 1.2.56, 1.3.x and 1.4.x before 1.4.19, and 1.5.x before 1.5.26 are affected.<br>You can read more about the vulnerability in CVE-2015-8540. For other technical questions about the vulnerability, you can post to Stack Overflow and use the tag “android-security.”<br>While these specific issues may not affect every app that uses libpng, it’s best to stay up to date on all security patches.<br>We’re here to help<br>If you feel we have sent this warning in error, you can contact our developer support team.<br>Regards,<br>The Google Play Team</p>
</blockquote>
<p>由于收到警告的这个老项目用的是cocos2d-x 2.2.6, libpng的版本是1.2.46, 见png.h:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> PNG_LIBPNG_VER <span class="number">10246</span> <span class="comment">/* 1.2.46 */</span></span></span><br></pre></td></tr></table></figure></p>
<p>我看了下新项目的cocos2d-x 3.10的，是1.6.16，满足Google Play的要求，直接拿过来用，路径：/Users/lux/git/MetaFun_projects/cocos2d-x-2.2.6/cocos2dx/platform/third_party/android/prebuilt/libpng</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> PNG_LIBPNG_VER_STRING <span class="string">"1.6.16"</span></span></span><br></pre></td></tr></table></figure>
<p>编译过程中报错：<br>/Users/lux/git/MetaFun_projects/cocos2d-x-2.2.6/projects/ColorRun/proj.android/../../../cocos2dx/platform/third_party/android/prebuilt/libpng/libs/armeabi/libpng.a(pngrutil.o):pngrutil.c:function png_inflate_claim: error: undefined reference to ‘inflateReset2’<br>/Users/lux/git/MetaFun_projects/cocos2d-x-2.2.6/projects/ColorRun/proj.android/../../../cocos2dx/platform/third_party/android/prebuilt/libpng/libs/armeabi/libpng.a(pngrutil.o):pngrutil.c:function png_decompress_chunk.constprop.5: error: undefined reference to ‘inflateReset2’<br>collect2: error: ld returned 1 exit status<br>make: <em>*</em> [obj/local/armeabi/libcocos2dcpp.so] Error 1<br>make: Leaving directory `/Users/lux/git/MetaFun_projects/cocos2d-x-2.2.6/projects/ColorRun/proj.android’</p>
<p>查了下inflateReset2，是libz的方法，cocos2d-x 2.2.6用的是ndk里面的libz，和新版本的libpng不兼容，因此直接从cocos2d-x 3.10中拿过来libz（免去自己编译麻烦）</p>
<p>直接放到：./cocos2d-x-2.2.6/cocos2dx/platform/third_party/android/prebuilt/zlib<br>修改mk：./cocos2d-x-2.2.6/cocos2dx/Android.mk<br>增加：LOCAL_WHOLE_STATIC_LIBRARIES += cocos_zlib_static和$(call import-module,zlib)</p>
<p>编译完成，打包apk提交新版本。:)</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/06/16/cocos2d-x-add-memory-show/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">cocos2d-x增加内存使用的显示</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="Google-Play-warnings" data-title="Google Play warning(You are using a vulnerable version of libpng)" data-url="http://xiao.luucio.com/2016/06/17/Google-Play-warnings/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"terrygo"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 Luucio
    	</div>
        <div class="footer-middle">
            <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
            本页总访问 <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> 次
      	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71108475-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>